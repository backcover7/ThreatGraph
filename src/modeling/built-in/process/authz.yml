module:
  process:
    - metadata:
        id: 02dd4cf4-1e8b-4535-9933-7cca60d5289d
        name: Normal Authentication Process
        description: OAuth2 Authentication
        icon: data:image/png;base64,...
        type: authentication
      groups: [ authentication ]
      attributes:
        critical: 3
        isSanitizer: true
        isAuthn: false
        operation: w

    - metadata:
        id: b21dc275-a75f-45fc-9522-b7fb439efeee
        name: Password Authentication Process
        description: Authentication uses password as credential
        icon: data:image/png;base64,...
        type: authentication
      groups: [ authentication ]
      attributes:
        critical: 3
        isSanitizer: true
        isAuthn: false
        operation: w
      additions:
        password:
          minLength:
            type: number
            description: Minimum length of the password
          requireUppercase:
            type: boolean
            description: Whether uppercase letters are required
          requireLowercase:
            type: boolean
            description: Whether lowercase letters are required
          requireNumbers:
            type: boolean
            description: Whether numbers are required
          requireSpecialChars:
            type: boolean
            description: Whether special characters are required
          expiration:
            type: boolean
            description: Whether password has expiration
        requireCaptcha:
          type: boolean
          description: Whether CAPTCHA is required during authentication
        hasRetryLimitation:
          type: boolean
          description: Whether there's a limit on retry attempts

    - metadata:
        id: de98418e-f62b-4ff6-baa9-5f8301eb50b9
        name: OAuth2 Authentication Process
        description: OAuth2 Authentication
        icon: data:image/png;base64,...
        type: authentication
      groups: [ authentication ]
      attributes:
        critical: 3
        isSanitizer: true
        isAuthn: false
        operation: w

    - metadata:
        id: 22134942-2735-4cf8-8586-72d28846d725
        name: SSO Authentication Process
        description: OAuth2 Authentication
        icon: data:image/png;base64,...
        type: authentication
      groups: [ authentication ]
      attributes:
        critical: 3
        isSanitizer: true
        isAuthn: false
        operation: w
  threat:
    - id: 461c0696-9811-413b-98ff-f5073f7b88a3
      name: Weak password policy
      severity: low
      description: Weak password is more vulnerable to brute force attack
      mitigation: Password authentication requires user to create a robust complex password.
      compliance:
        cwe:
          - 'CWE-521: Weak Password Requirements'
        owasp:
          - 'A07:2021 - Identification and Authentication Failures'
        stride:
          - Information Disclosure
          - Elevation of Privilege

    - id: e1f06cab-4818-4c49-ace3-00a46f9e0e91
      name: Never expired password
      severity: low
      description: Password never expires.
      mitigation: User should be asked to update their password in a period.
      compliance:
        cwe:
          - 'CWE-263: Password Aging with Long Expiration'
        owasp:
          - 'A07:2021 Identification and Authentication Failures'
        stride:
          - Information Disclosure

    - id: 9e85bda8-1858-407c-8c2a-67a2496b3c9a
      name: Brute force attack
      severity: low
      description: Credential authentication is vulnerable to brute force attack.
      mitigation: Captcha challenge or retry restriction will mitigate brute force attack.
      compliance:
        cwe:
          - 'CWE-307: Improper Restriction of Excessive Authentication Attempts'
        owasp:
          - 'A07:2021 Identification and Authentication Failures'
        stride:
          - Spoofing
          - Information Disclosure

    # TODO oauth threat for de98418e-f62b-4ff6-baa9-5f8301eb50b9 process element
  rule:
    - id: 4f81f0a6-b47a-433e-961f-df917a992a72
      threat: 461c0696-9811-413b-98ff-f5073f7b88a3
      element:
        type: process
        id: b21dc275-a75f-45fc-9522-b7fb439efeee
      designs:
        - either:
          - design: additions.password.minLength <= 8
          - design: additions.password.requireUppercase = false
          - design: additions.password.requireLowercase = false
          - design: additions.password.requireNumbers = false
          - design: additions.password.requireSpecialChars = false

    - id: 7ea81d28-e509-4f6b-8f24-b2bddad9f15e
      threat: e1f06cab-4818-4c49-ace3-00a46f9e0e91
      element:
        type: process
        id: b21dc275-a75f-45fc-9522-b7fb439efeee
      designs:
        - design: additions.password.expiration = false

    - id: 87505539-92c6-4ab1-b045-c16aa432e37c
      threat: 9e85bda8-1858-407c-8c2a-67a2496b3c9a
      element:
        type: process
        id: b21dc275-a75f-45fc-9522-b7fb439efeee
      designs:
        - either:
          - design: additions.requireCaptcha = false
          - design: additions.hasRetryLimitation = false